<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FRC External WebUI (NetworkTables)</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- Optional: WPILib NetworkTablesClients JS (place a built/minified client at vendor/nt4-wpilib.js) -->
    <script src="vendor/nt4-wpilib.js" defer></script>
    <!-- Try multiple CDN candidates for NT4 UMD, then fall back to local vendor copy if offline -->
    <script>
      (function loadNTCore() {
        const candidates = [
          // Common published package
          'https://unpkg.com/ntcore-ts/dist/ntcore.umd.js',
          // Version-pinned example (edit if you know the version you use)
          'https://unpkg.com/ntcore-ts@0.2.5/dist/ntcore.umd.js',
          // Alternate scope (if published under @wpilib)
          'https://unpkg.com/@wpilib/ntcore-ts/dist/ntcore.umd.js',
        ];
        function tryNext(i) {
          if (i >= candidates.length) {
            const local = document.createElement('script');
            local.src = 'vendor/ntcore.umd.js';
            local.async = true;
            document.head.appendChild(local);
            return;
          }
          const s = document.createElement('script');
          s.src = candidates[i];
          s.async = true;
          s.onload = () => {/* ok */};
          s.onerror = () => tryNext(i + 1);
          document.head.appendChild(s);
        }
        tryNext(0);
      })();
    </script>
  </head>
  <body>
    <header>
      <h1>External WebUI (NT4)</h1>
      <p class="sub">Hosts anywhere. Connects to roboRIO NetworkTables.</p>
    </header>

    <section class="card">
      <h2>Connection</h2>
      <div class="row">
        <label for="rioHost">roboRIO host/IP</label>
        <input id="rioHost" type="text" placeholder="roborio-XXXX-frc.local" />
      </div>
      <div class="row">
        <label for="clientName">Client name</label>
        <input id="clientName" type="text" value="ipad-ui" />
      </div>
      <div class="row">
        <button id="connectBtn">Connect</button>
        <button id="disconnectBtn" disabled>Disconnect</button>
        <span id="status" class="status">Not connected</span>
      </div>
      <p class="hint">
        Tip: Default NT4 WebSocket is <code>ws://ROBORIO:5810/nt/</code>.
      </p>
      <div id="ntLibWarning" class="warn" hidden>
        NT client library not loaded. If offline, download the UMD build and place it at
        <code>webui/vendor/ntcore.umd.js</code>. See <a href="vendor/README.md">vendor/README.md</a>.
      </div>
    </section>

    <section class="grid">
      <div class="card">
        <h2>Autonomy Control</h2>
        <div class="row">
          <label>
            <input id="ctlEnabled" type="checkbox" /> Autonomous Enabled
          </label>
        </div>
        <div class="row">
          <label for="face">Face</label>
          <select id="face">
            <option>REEF_1</option>
            <option>REEF_2</option>
            <option>REEF_3</option>
            <option>REEF_4</option>
            <option>REEF_5</option>
            <option>REEF_6</option>
          </select>
        </div>
        <div class="row">
          <label for="side">Side</label>
          <select id="side">
            <option>LEFT</option>
            <option>RIGHT</option>
          </select>
        </div>
        <div class="row">
          <label for="level">Level</label>
          <select id="level">
            <option>L4</option>
            <option>L3</option>
            <option>L2</option>
            <option>L1</option>
          </select>
        </div>
        <div class="row">
          <label for="targetName">Target Name</label>
          <input id="targetName" type="text" placeholder="Reef_3_L_Blue" />
        </div>
        <div class="row">
          <button id="sendBtn">Send</button>
          <button id="triggerLoadBtn">Trigger Load</button>
          <button id="triggerReleaseBtn">Trigger Release</button>
        </div>
      </div>

      <div class="card">
        <h2>Robot State</h2>
        <div class="state">
          <div><span class="k">AutonomousEnabled</span> <span id="stEnabled" class="v">-</span></div>
          <div><span class="k">TargetFace</span> <span id="stFace" class="v">-</span></div>
          <div><span class="k">TargetSide</span> <span id="stSide" class="v">-</span></div>
          <div><span class="k">TargetLevel</span> <span id="stLevel" class="v">-</span></div>
          <div><span class="k">TargetName</span> <span id="stName" class="v">-</span></div>
        </div>
        <details>
          <summary>Branches</summary>
          <div id="branches" class="branches"></div>
        </details>
      </div>
    </section>

    <section class="card">
      <h2>Log</h2>
      <pre id="log" class="log"></pre>
    </section>

    <script src="app.js"></script>
  </body>
  </html>
